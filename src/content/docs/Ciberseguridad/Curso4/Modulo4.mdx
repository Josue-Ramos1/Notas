---
title: Curso 4 - Módulo 4 SQL
description: Introducción a bases de datos relacionales y lenguaje SQL aplicado a la ciberseguridad.
---

import { Card, CardGrid, Steps, Aside, Code } from '@astrojs/starlight/components';

# Introducción a SQL y a las bases de datos

## Introducción a Bases de Datos y su Estructura Relacional

### ¿Qué es una base de datos?

Una **base de datos** es una colección organizada de información o datos. Está diseñada para almacenar grandes volúmenes de información de manera estructurada, eficiente y accesible.

<CardGrid>
  <Card title="¿En qué se diferencia de una hoja de cálculo?">
    - Permite acceso simultáneo por múltiples usuarios.  
    - Maneja grandes volúmenes de datos.  
    - Ejecuta operaciones complejas de forma eficiente.
  </Card>
</CardGrid>

En ciberseguridad, las bases de datos pueden contener información como:
- Registros de intentos de inicio de sesión.
- Información sobre software y actualizaciones.
- Datos sobre dispositivos y usuarios asociados.

---

### Bases de Datos Relacionales

Las **bases de datos relacionales** organizan los datos en **tablas** relacionadas entre sí.

<Aside type="tip">
Cada tabla contiene **columnas (campos)** y **filas (registros)**.
</Aside>

Ejemplo de campos:
- `employee_id`
- `device_id`
- `username`

---

### Relaciones entre tablas

Una base de datos puede tener múltiples tablas **relacionadas** mediante una columna común.

<CardGrid>
  <Card title="Ejemplo de relación">
    - Tabla de empleados  
    - Tabla de dispositivos asignados  
    - Relación por `employee_id`
  </Card>
</CardGrid>

---

### Tipos de Claves

<Steps>
1. **Clave primaria (Primary Key)**  
   - Valores únicos y obligatorios.  
   - Identifica de forma única cada fila.  
   - Solo una por tabla.  
   - Ejemplo: `employee_id`.

2. **Clave foránea (Foreign Key)**  
   - Apunta a una clave primaria de otra tabla.  
   - Puede tener valores duplicados o vacíos.  
   - Establece relaciones entre tablas.  
   - Ejemplo: `employee_id` en tabla de dispositivos.
</Steps>

<Aside type="note">
Una tabla puede tener **una sola clave primaria** y **varias claves foráneas**.
</Aside>

---

## Introducción a SQL para Analistas de Seguridad

### ¿Qué es SQL?

**SQL** (Structured Query Language) es el lenguaje que permite:
- Crear bases de datos.
- Consultar y modificar datos.
- Extraer información relevante de forma estructurada.

<Aside type="tip">
SQL es esencial en ciberseguridad para acceder, analizar y filtrar registros.
</Aside>

---

### ¿Qué es una consulta?

Una **consulta** es una solicitud específica de información contenida en una o varias tablas de una base de datos.

<CardGrid>
  <Card title="¿Qué permite hacer una consulta en SQL?">
    - Acceder rápidamente a datos específicos.  
    - Analizar registros complejos.  
    - Filtrar solo lo relevante.
  </Card>
</CardGrid>

<Aside type="note">
Existen diferentes versiones de SQL, pero el funcionamiento general es el mismo.
</Aside>

---

### Aplicaciones de SQL en ciberseguridad

<Steps>
1. Identificar máquinas mal configuradas.
2. Detectar patrones inusuales en el uso de sistemas.
3. Filtrar registros para detectar actividad sospechosa.
4. Encontrar sistemas sin parches de seguridad.
5. Analizar los momentos óptimos para actualizaciones.
</Steps>

<Aside type="caution">
SQL puede procesar millones de registros en segundos. Su uso eficiente es clave para ahorrar tiempo y obtener resultados precisos.
</Aside>

---

### SQL y análisis de datos

Además de recuperar información, SQL se usa para realizar análisis básicos que ayudan a anticipar amenazas basadas en patrones históricos.

<CardGrid>
  <Card title="Ejemplos de preguntas que SQL ayuda a responder">
    - ¿Qué máquinas son vulnerables actualmente?  
    - ¿Cuándo es más seguro ejecutar tareas críticas?  
    - ¿Qué eventos ocurrieron antes de un incidente?
  </Card>
</CardGrid>

# Consultas SQL

## Consultas SQL básicas y ordenación de resultados

### Fundamentos de una consulta SQL

Las consultas SQL permiten recuperar datos de bases de datos de forma estructurada. Una **consulta** es una solicitud de información extraída de una o más tablas.

<CardGrid>
  <Card title="Palabras clave fundamentales">
    - `SELECT`: columnas a recuperar  
    - `FROM`: tabla origen de los datos
  </Card>
</CardGrid>

<Code language="sql" code={`SELECT employee_id, device_id
FROM employees;`} />

<Aside type="note">
Esta consulta recupera las columnas `employee_id` y `device_id` de la tabla `employees`.
</Aside>

---

### Base de datos Chinook

La base de datos de ejemplo **Chinook** simula una empresa de medios digitales. Contiene 11 tablas como:

- `employees`
- `customers`
- `invoices`

<Code language="sql" code={`SELECT customerid, city, country
FROM customers;`} />

---

### Selección de columnas

<Steps>
1. Selección específica:  
   <Code language="sql" code={`SELECT customerid, city FROM customers;`} />
2. Selección de todas las columnas:  
   <Code language="sql" code={`SELECT * FROM customers;`} />
</Steps>

<Aside type="caution">
`SELECT *` puede ser ineficiente en bases de datos grandes; es preferible seleccionar solo las columnas necesarias.
</Aside>

---

### Ordenamiento de resultados con `ORDER BY`

La cláusula `ORDER BY` permite organizar los resultados en orden ascendente (por defecto) o descendente (`DESC`).

<CardGrid>
  <Card title="Orden ascendente por ciudad">
    <Code language="sql" code={`SELECT customerid, city, country
FROM customers
ORDER BY city;`} />
  </Card>

  <Card title="Orden descendente por ciudad">
    <Code language="sql" code={`SELECT customerid, city, country
FROM customers
ORDER BY city DESC;`} />
  </Card>

  <Card title="Orden por múltiples columnas">
    <Code language="sql" code={`SELECT customerid, city, country
FROM customers
ORDER BY country, city;`} />
  </Card>
</CardGrid>

---

## La cláusula WHERE y los operadores básicos en SQL

### Uso de filtros en SQL

<Aside type="tip">
En ciberseguridad, filtrar datos con SQL permite identificar eventos clave y patrones anómalos entre grandes volúmenes de registros.
</Aside>

---

### Cláusula `WHERE`

Permite filtrar los registros de una consulta según condiciones específicas.

<Code language="sql" code={`SELECT firstname, lastname, title, email
FROM employees
WHERE title = 'IT Staff';`} />

<Aside type="note">
Las consultas en SQL deben finalizar con `;`, incluso después de `WHERE`.
</Aside>

---

### Filtrado por patrones: `LIKE` y comodines

SQL permite utilizar **patrones flexibles** mediante `LIKE` y los siguientes comodines:

| Comodín | Significado |
|---------|-------------|
| `%`     | Cualquier número de caracteres |
| `_`     | Un solo carácter exacto        |

<CardGrid>
  <Card title="Ejemplos de patrones">
    `a%` → apple, art, a  
    `a_` → as, an, a7  
    `%a%` → again, pizza, data  
    `_a_` → car, ban, ea7  
  </Card>
</CardGrid>

---

#### Ejemplo con `LIKE`

<Code language="sql" code={`SELECT lastname, firstname, title, email
FROM employees
WHERE title LIKE 'IT%';`} />

Devuelve títulos como “IT Staff” o “IT Manager”.

---

#### Ejemplo avanzado

Buscar estados con abreviaturas que comiencen con "N" y tengan dos caracteres:

<Code language="sql" code={`SELECT firstname, lastname, state, country
FROM customers
WHERE state LIKE 'N_';`} />

---

### Aplicaciones prácticas en ciberseguridad

<Steps>
1. **Filtrar intentos de acceso**: De un usuario específico.
2. **Identificar eventos**: Ocurridos durante un incidente.
3. **Detectar sistemas**: Con versiones vulnerables de software.
4. **Analizar actividades**: Inusuales por patrón de uso.
</Steps>

# Más filtros SQL

## Operadores para filtrar fechas y números en SQL

### Tipos de datos en ciberseguridad

Como analista de seguridad, se trabaja no solo con datos de tipo texto, sino también con:

- **Datos numéricos**: intentos de inicio de sesión, volumen de datos, recuentos de eventos.
- **Datos de fecha y hora**: fechas de inicio de sesión, marcas de tiempo, duración de conexiones.

<Aside type="note">
El uso adecuado de estos datos permite detectar comportamientos sospechosos o fuera de lo normal.
</Aside>

---

### Operadores de comparación en SQL

Los operadores de comparación permiten filtrar datos específicos en las consultas:

| Operador | Significado         |
|----------|---------------------|
| `<`      | Menor que           |
| `>`      | Mayor que           |
| `=`      | Igual a             |
| `<=`     | Menor o igual que   |
| `>=`     | Mayor o igual que   |
| `<>`     | Distinto de         |
| `!=`     | Distinto de (alt.)  |

---

### Ejemplo con fechas

<Code language="sql" code={`SELECT firstname, lastname, birthdate
FROM employees
WHERE birthdate >= '1970-01-01';`} />

<Aside type="tip">
- `>`: exclusivo (no incluye el valor comparado)  
- `>=`: inclusivo (sí incluye el valor comparado)
</Aside>

---

### El operador `BETWEEN`

Permite filtrar valores dentro de un rango **incluyendo** los extremos.

<Code language="sql" code={`SELECT firstname, lastname, hiredate
FROM employees
WHERE hiredate BETWEEN '2002-01-01' AND '2003-01-01';`} />

<Aside type="note">
Devuelve empleados contratados entre el 1 de enero de 2002 y el 1 de enero de 2003.
</Aside>

---

### Aplicación en ciberseguridad

<Steps>
1. **Filtrar intentos**: según fecha y hora del evento.
2. **Identificar eventos**: dentro de un periodo específico.
3. **Evaluar crecimiento**: de tráfico o número de eventos durante incidentes.
4. **Encontrar patrones**: que ocurren en rangos de tiempo determinados.
</Steps>

---

## Filtros avanzados con operadores lógicos: AND, OR y NOT

### Introducción

Los operadores lógicos permiten construir condiciones complejas para filtrar información relevante en ciberseguridad.

---

### `AND` (Y lógico)

<Code language="sql" code={`SELECT firstname, lastname, email, country, supportrepid
FROM customers
WHERE supportrepid = 5 AND country = 'USA';`} />

<Aside type="tip">
Devuelve clientes con **ID de soporte 5** y **ubicados en EE. UU.**
</Aside>

---

### `OR` (O lógico)

<Code language="sql" code={`SELECT firstname, lastname, email, country
FROM customers
WHERE country = 'Canada' OR country = 'USA';`} />

<Aside type="note">
Devuelve clientes de **Canadá o EE. UU.**. Se debe repetir la condición completa.
</Aside>

---

### `NOT` (Negación lógica)

<Code language="sql" code={`SELECT firstname, lastname, email, country
FROM customers
WHERE NOT country = 'USA';`} />

<Aside type="note">
Devuelve los clientes que **no están en EE. UU.**
</Aside>

<CardGrid>
  <Card title="Alternativas a NOT">
    <Code language="sql" code={`WHERE country <> 'USA'`} />  
    <Code language="sql" code={`WHERE country != 'USA'`} />
  </Card>
</CardGrid>

---

### Combinación de operadores lógicos

<Code language="sql" code={`SELECT firstname, lastname, email, country
FROM customers
WHERE NOT country = 'Canada' AND NOT country = 'USA';`} />

<Aside type="tip">
Consulta avanzada que filtra clientes que **no están en Canadá ni en EE. UU.**
</Aside>

# Uniones SQL

## Comparación de tipos de uniones en SQL

### Introducción

En ciberseguridad, es común trabajar con múltiples tablas relacionadas. Las **uniones (JOINs)** en SQL permiten combinar información de estas tablas cuando comparten una columna en común. Existen distintos tipos de uniones, cada uno con un comportamiento específico respecto a qué filas se incluyen en los resultados.

---

### INNER JOIN (Unión interna)

- **Función:** Devuelve **solo las filas con coincidencias** en ambas tablas.
- **Sintaxis:**

<Code language="sql" code={`SELECT *
FROM employees
INNER JOIN machines ON employees.device_id = machines.device_id;`} />

- Para evitar ambigüedad en columnas compartidas:

<Code language="sql" code={`SELECT username, operating_system, employees.device_id
FROM employees
INNER JOIN machines ON employees.device_id = machines.device_id;`} />

<Aside type="note">
Devuelve solo los registros donde `device_id` coincide en ambas tablas.
</Aside>

---

### LEFT JOIN (Unión externa izquierda)

- **Función:** Devuelve **todas las filas de la tabla izquierda**, y solo las coincidencias de la tabla derecha.

<Code language="sql" code={`SELECT *
FROM employees
LEFT JOIN machines ON employees.device_id = machines.device_id;`} />

<Aside type="tip">
Incluye todos los registros de `employees`, aunque no tengan coincidencias en `machines`.
</Aside>

---

### RIGHT JOIN (Unión externa derecha)

- **Función:** Devuelve **todas las filas de la tabla derecha**, y solo las coincidencias de la izquierda.

<Code language="sql" code={`SELECT *
FROM employees
RIGHT JOIN machines ON employees.device_id = machines.device_id;`} />

<Aside type="note">
Incluye todos los registros de `machines`, incluso sin coincidencias en `employees`.
</Aside>

<Code language="sql" code={`SELECT *
FROM machines
LEFT JOIN employees ON employees.device_id = machines.device_id;`} />

<Aside type="tip">
Un `RIGHT JOIN` se puede reemplazar por un `LEFT JOIN` invirtiendo el orden de las tablas.
</Aside>

---

### FULL OUTER JOIN (Unión externa completa)

- **Función:** Devuelve **todos los registros** de ambas tablas, coincidan o no.

<Code language="sql" code={`SELECT *
FROM employees
FULL OUTER JOIN machines ON employees.device_id = machines.device_id;`} />

<Aside type="note">
Incluye coincidencias y los registros sin correspondencia de ambas tablas.
</Aside>

---

### Comparación general

| Tipo de unión       | Incluye filas sin coincidencia | Tabla siempre incluida     |
|---------------------|-------------------------------|-----------------------------|
| INNER JOIN          | No                            | Ninguna                     |
| LEFT JOIN           | Sí                            | Tabla izquierda (`FROM`)    |
| RIGHT JOIN          | Sí                            | Tabla derecha (`JOIN`)      |
| FULL OUTER JOIN     | Sí, en ambas tablas            | Ambas                       |

---

## Aprendizaje continuo en SQL

### Introducción

A lo largo del curso se han explorado fundamentos de SQL como filtros y uniones. Este módulo introduce las **funciones de agregación** y da recomendaciones para seguir aprendiendo por cuenta propia.

---

### ¿Qué son las funciones de agregación?

Permiten realizar **cálculos sobre múltiples filas** y devuelven un único valor resumen. No muestran los datos individuales.

| Función   | Descripción                                  |
|----------|----------------------------------------------|
| `COUNT()` | Cuenta filas (excluye `NULL`)                |
| `AVG()`   | Calcula el promedio de una columna numérica |
| `SUM()`   | Suma total de una columna numérica          |

---

### Sintaxis general

<Code language="sql" code={`SELECT FUNCIÓN(columna)
FROM tabla
[WHERE condición];`} />

#### Ejemplos

1. **Contar registros totales:**

<Code language="sql" code={`SELECT COUNT(firstname)
FROM customers;`} />

2. **Contar con condición:**

<Code language="sql" code={`SELECT COUNT(firstname)
FROM customers
WHERE country = 'USA';`} />

<Aside type="note">
La sintaxis de `AVG()` y `SUM()` es igual, solo cambia la función y columna.
</Aside>

---

### Continuar aprendiendo SQL

<Steps>
1. **Buscar recursos adicionales**: Investiga conceptos y ejemplos en línea.
2. **Practicar constantemente**: Usa entornos de prueba para reforzar lo aprendido.
3. **Aplicar SQL a seguridad**: Piensa qué tipo de información necesitas y cómo extraerla con SQL.
4. **Explorar funciones nuevas**: Aprende `GROUP BY`, `HAVING`, subconsultas y funciones de ventana.
</Steps>

<Aside type="tip">
La práctica, la curiosidad y los recursos adecuados son claves para dominar SQL.
</Aside>